
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pyqstrat package &#8212; pyqstrat  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyqstrat.examples package" href="pyqstrat.examples.html" />
    <link rel="prev" title="Welcome to pyqstrat’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="pyqstrat-package">
<h1>pyqstrat package<a class="headerlink" href="#pyqstrat-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyqstrat.examples.html">pyqstrat.examples package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyqstrat.examples.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyqstrat.examples.html#module-pyqstrat.examples.build_example_strategy">pyqstrat.examples.build_example_strategy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyqstrat.examples.html#module-pyqstrat.examples">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-pyqstrat.evaluator">
<span id="pyqstrat-evaluator-module"></span><h2>pyqstrat.evaluator module<a class="headerlink" href="#module-pyqstrat.evaluator" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.evaluator.Evaluator">
<em class="property">class </em><code class="descclassname">pyqstrat.evaluator.</code><code class="descname">Evaluator</code><span class="sig-paren">(</span><em>initial_metrics</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>You add functions to the evaluator that are dependent on the outputs of other functions.  The evaluator will call these functions in the right order
so dependencies are computed first before the functions that need their output.  You can retrieve the output of a metric using the metric member function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span><span class="n">initial_metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">add_scalar_metric</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="go">array([ 9, 10, 11])</span>
</pre></div>
</div>
<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.add_bucketed_metric">
<code class="descname">add_bucketed_metric</code><span class="sig-paren">(</span><em>name</em>, <em>func</em>, <em>dependencies</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.add_bucketed_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.add_bucketed_metric" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.add_rolling_metric">
<code class="descname">add_rolling_metric</code><span class="sig-paren">(</span><em>name</em>, <em>func</em>, <em>dependencies</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.add_rolling_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.add_rolling_metric" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.add_scalar_metric">
<code class="descname">add_scalar_metric</code><span class="sig-paren">(</span><em>name</em>, <em>func</em>, <em>dependencies</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.add_scalar_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.add_scalar_metric" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.compute">
<code class="descname">compute</code><span class="sig-paren">(</span><em>metric_names=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.compute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.compute" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute metrics using the internal dependency graph
Args:</p>
<blockquote>
<div>metric_names: an array of metric names.  If not passed in, evaluator will compute and store all metrics</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.compute_metric">
<code class="descname">compute_metric</code><span class="sig-paren">(</span><em>metric_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.compute_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.compute_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute and store a single metric:
Args:</p>
<blockquote>
<div>metric_name: string representing the metric to compute</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.metric">
<code class="descname">metric</code><span class="sig-paren">(</span><em>metric_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the value of a single metric given its name</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.evaluator.Evaluator.metrics">
<code class="descname">metrics</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of metric name -&gt; metric value</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_amean">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_amean</code><span class="sig-paren">(</span><em>returns</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_amean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_amean" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes arithmetic mean of a return array, ignoring NaNs
Args:</p>
<blockquote>
<div>returns: a numpy array of floats representing returns at any frequency</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd>a float</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compute_amean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]))</span>
<span class="go">3.5</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_annual_returns">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_annual_returns</code><span class="sig-paren">(</span><em>dates</em>, <em>returns</em>, <em>periods_per_year</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_annual_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_annual_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the output of compute_bucketed_returns and returns geometric mean of returns by year
Returns:</p>
<blockquote>
<div>A tuple with the first element being an array of years (integer) and the second element 
an array of annualized returns for those years</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_bucketed_returns">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_bucketed_returns</code><span class="sig-paren">(</span><em>dates</em>, <em>returns</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_bucketed_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_bucketed_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Bucket returns by year
Returns:</p>
<blockquote>
<div>A tuple with the first element being a list of years and the second a list of numpy arrays containing returns for each corresponding year</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_calmar">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_calmar</code><span class="sig-paren">(</span><em>returns_3yr</em>, <em>periods_per_year</em>, <em>mdd_pct_3yr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_calmar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_calmar" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute Calmar ratio, which is the annualized return divided by max drawdown over the last 3 years</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_dates_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_dates_3yr</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_dates_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_dates_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an array of numpy datetimes, return those that are within 3 years of the last date in the array</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_equity">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_equity</code><span class="sig-paren">(</span><em>dates</em>, <em>starting_equity</em>, <em>returns</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_equity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_equity" title="Permalink to this definition">¶</a></dt>
<dd><p>Given starting equity, dates and returns, create a numpy array of equity at each date</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_gmean">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_gmean</code><span class="sig-paren">(</span><em>returns</em>, <em>periods_per_year</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_gmean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_gmean" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes geometric mean of an array of returns
Args:</p>
<blockquote>
<div>returns: a numpy array of returns
periods_per_year: number of trading periods per year</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd>a float</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_gmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">]),</span> <span class="mf">252.</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">0.654358</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_mar">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_mar</code><span class="sig-paren">(</span><em>returns</em>, <em>periods_per_year</em>, <em>mdd_pct</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_mar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_mar" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute MAR ratio, which is annualized return divided by biggest drawdown since inception.</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_date">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_date</code><span class="sig-paren">(</span><em>rolling_dd_dates</em>, <em>rolling_dd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute date of max drawdown given numpy array of dates, and corresponding rolling dd percentages</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_date_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_date_3yr</code><span class="sig-paren">(</span><em>rolling_dd_3yr_dates</em>, <em>rolling_dd_3yr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_date_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_date_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute max drawdown date over the last 3 years</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_pct">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_pct</code><span class="sig-paren">(</span><em>rolling_dd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_pct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_pct" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute max drawdown percentage given a numpy array of rolling drawdowns, ignoring NaNs</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_pct_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_pct_3yr</code><span class="sig-paren">(</span><em>rolling_dd_3yr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_pct_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_pct_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute max drawdown percentage over the last 3 years</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_start">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_start</code><span class="sig-paren">(</span><em>rolling_dd_dates</em>, <em>rolling_dd</em>, <em>mdd_date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute date when max drawdown starts, given numpy array of dates, corresponding rolling dd percentages and date that max dd starts</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_maxdd_start_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_maxdd_start_3yr</code><span class="sig-paren">(</span><em>rolling_dd_3yr_dates</em>, <em>rolling_dd_3yr</em>, <em>mdd_date_3yr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_start_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_start_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Comput max drawdown start date over the last 3 years</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_periods_per_year">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_periods_per_year</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_periods_per_year"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_periods_per_year" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes trading periods per year for an array of numpy datetime64’s. E.g. if most of the dates are separated by 1 day, will return 252.
Args:</p>
<blockquote>
<div>dates: a numpy array of datetime64’s</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd>a float</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compute_periods_per_year</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[D]&#39;</span><span class="p">))</span>
<span class="go">252.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_return_metrics">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_return_metrics</code><span class="sig-paren">(</span><em>dates</em>, <em>rets</em>, <em>starting_equity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_return_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_return_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a set of common metrics using returns (for example, of an instrument or a portfolio)</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>dates: a numpy datetime array with one date per return
rets: a numpy float array of returns
starting_equity: starting equity value in your portfolio</dd>
<dt>Returns:</dt>
<dd>An Evaluator object containing computed metrics off the returns passed in.  
If needed, you can add your own metrics to this object based on the values of existing metrics and recompute the Evaluator.
Otherwise, you can just use the output of the evaluator using the metrics function.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_returns_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_returns_3yr</code><span class="sig-paren">(</span><em>dates</em>, <em>returns</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_returns_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_returns_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an array of numpy datetimes and an array of returns, return those that are within 3 years of the last date in the datetime array</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_rolling_dd">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_rolling_dd</code><span class="sig-paren">(</span><em>dates</em>, <em>equity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_rolling_dd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_rolling_dd" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute numpy array of rolling drawdown percentage
Args:</p>
<blockquote>
<div>dates: numpy array of datetime64
equity: numpy array of equity</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_rolling_dd_3yr">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_rolling_dd_3yr</code><span class="sig-paren">(</span><em>dates</em>, <em>equity</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_rolling_dd_3yr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_rolling_dd_3yr" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute rolling drawdowns over the last 3 years</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_sharpe">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_sharpe</code><span class="sig-paren">(</span><em>returns</em>, <em>amean</em>, <em>periods_per_year</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_sharpe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_sharpe" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this does not take into risk free returns so it’s really a sharpe0, i.e. assumes risk free returns are 0
Args:</p>
<blockquote>
<div>returns: a numpy array of returns
amean: arithmetic mean of returns
periods_per_year: number of trading periods per year</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_sharpe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">]),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">12.727922</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_sortino">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_sortino</code><span class="sig-paren">(</span><em>returns</em>, <em>amean</em>, <em>periods_per_year</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_sortino"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_sortino" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this assumes target return is 0.
Args:</p>
<blockquote>
<div>returns: a numpy array of returns
amean: arithmetic mean of returns
periods_per_year: number of trading periods per year</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_sortino</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">]),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">33.674916</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.compute_std">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">compute_std</code><span class="sig-paren">(</span><em>returns</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_std"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_std" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes standard deviation of an array of returns, ignoring nans</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.display_return_metrics">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">display_return_metrics</code><span class="sig-paren">(</span><em>metrics</em>, <em>float_precision=3</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#display_return_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.display_return_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a dataframe making it convenient to view the output of the metrics obtained using the compute_return_metrics function.
Args:</p>
<blockquote>
<div>float_precision: Change if you want to display floats with more or less significant figures than the default, 3 significant figures.</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd>A one row dataframe with formatted metrics.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.plot_return_metrics">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">plot_return_metrics</code><span class="sig-paren">(</span><em>metrics</em>, <em>title=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#plot_return_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.plot_return_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot equity, rolling drawdowns and and a boxplot of annual returns given the output of compute_return_metrics.</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.evaluator.test_evaluator">
<code class="descclassname">pyqstrat.evaluator.</code><code class="descname">test_evaluator</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#test_evaluator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.evaluator.test_evaluator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-pyqstrat.marketdata">
<span id="pyqstrat-marketdata-module"></span><h2>pyqstrat.marketdata module<a class="headerlink" href="#module-pyqstrat.marketdata" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.marketdata.MarketData">
<em class="property">class </em><code class="descclassname">pyqstrat.marketdata.</code><code class="descname">MarketData</code><span class="sig-paren">(</span><em>dates</em>, <em>c</em>, <em>o=None</em>, <em>h=None</em>, <em>l=None</em>, <em>v=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Used to store OHLCV bars.  You must at least supply dates and close prices.  All other fields are optional.
Attributes:</p>
<blockquote>
<div>dates: A numpy datetime array with the datetime for each bar.  Must be monotonically increasing.
c:     A numpy float array with close prices for the bar.
o:     A numpy float array with open prices 
h:     A numpy float array with high prices
l:     A numpy float array with high prices
v:     A numpy integer array with volume for the bar</div></blockquote>
<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.describe">
<code class="descname">describe</code><span class="sig-paren">(</span><em>warn_std=10</em>, <em>time_distribution_frequency='15 min'</em>, <em>print_time_distribution=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.describe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.describe" title="Permalink to this definition">¶</a></dt>
<dd><p>Describe the bars.  Shows an overview, errors and warnings for the bar data.  This is a good function to use 
before running any backtests on a set of bar data
Args:</p>
<blockquote>
<div>warn_std: See warning function
time_distribution_frequency: See time_distribution function
print_time_distribution: Whether to print the time distribution in addition to plotting it.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.df">
<code class="descname">df</code><span class="sig-paren">(</span><em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.df" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.errors">
<code class="descname">errors</code><span class="sig-paren">(</span><em>display=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.errors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.errors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe indicating any highs that are lower than opens, closes, lows or lows that are higher than other columns
Also includes any ohlcv values that are negative</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.freq_str">
<code class="descname">freq_str</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.freq_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.freq_str" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.is_ohlc">
<code class="descname">is_ohlc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.is_ohlc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.is_ohlc" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if we have all ohlc columns and none are empty</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.overview">
<code class="descname">overview</code><span class="sig-paren">(</span><em>display=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.overview"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.overview" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe showing basic information about the data, including count, number and percent missing, min, max
Args:</p>
<blockquote>
<div>display:  Whether to print out the warning dataframe as well as returning it</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.plot">
<code class="descname">plot</code><span class="sig-paren">(</span><em>figsize=(15</em>, <em>8)</em>, <em>date_range=None</em>, <em>sampling_frequency=None</em>, <em>title='Price / Volume'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a candlestick or line plot depending on whether we have ohlc data or just close prices
Args:</p>
<blockquote>
<div>figsize: Size of the figure (default (15,8))
date_range: A tuple of strings or numpy datetimes for plotting a smaller sample of the data, e.g. (“2018-01-01”, “2018-01-06”)
sampling_frequency: Downsample before plotting.  See pandas frequency strings for possible values.
title: Title of the graph, default “Price / Volume”</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.resample">
<code class="descname">resample</code><span class="sig-paren">(</span><em>sampling_frequency</em>, <em>inplace=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.resample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.resample" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample the OHLCV data into a new bar frequency
Args:</p>
<blockquote>
<div>sampling_frequency: See sampling frequency in pandas
inplace: If set to False, don’t modify this object, return a new object instead.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.time_distribution">
<code class="descname">time_distribution</code><span class="sig-paren">(</span><em>frequency='15 minutes'</em>, <em>display=True</em>, <em>plot=True</em>, <em>figsize=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.time_distribution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.time_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dataframe with the time distribution of the bars
Args:</p>
<blockquote>
<div>frequency: The width of each bin (default “15 minutes”).  You can use hours or days as well.
display:   Whether to display the data in addition to returning it.
plot:      Whether to plot the data in addition to returning it.
figsize:   If plot is set, optional figure size for the plot (default (20,8))</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.valid_row">
<code class="descname">valid_row</code><span class="sig-paren">(</span><em>i</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.valid_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.valid_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the row with index i has no nans in it.</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.marketdata.MarketData.warnings">
<code class="descname">warnings</code><span class="sig-paren">(</span><em>warn_std=10</em>, <em>display=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#MarketData.warnings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.MarketData.warnings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe indicating any values where the bar over bar change is more than warn_std standard deviations.
Args:</p>
<blockquote>
<div>warn_std: Number of standard deviations to use as a threshold (default 10)
display:  Whether to print out the warning dataframe as well as returning it</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="pyqstrat.marketdata.roll_futures">
<code class="descclassname">pyqstrat.marketdata.</code><code class="descname">roll_futures</code><span class="sig-paren">(</span><em>md</em>, <em>date_func</em>, <em>condition_func</em>, <em>expiries=None</em>, <em>return_full_df=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#roll_futures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.roll_futures" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a continuous futures dataframe with one row per datetime given rolling logic
Args:</p>
<blockquote>
<div><dl class="docutils">
<dt>md: A dataframe containing the columns ‘date’, ‘series’, and any other market data, for example, ohlcv data. Date can contain time for sub-daily bars. </dt>
<dd>The series column must contain a different string name for each futures series, e.g. SEP2018, DEC2018, etc.</dd>
<dt>date_func: A function that takes the market data object as an input and returns a numpy array of booleans</dt>
<dd>True indicates that the future should be rolled on this date if the condition specified in condition_func is met.
This function can assume that we have all the columns in the original market data object plus the same columns suffixed with _next for the potential series
to roll over to.</dd>
<dt>condition_func: A function that takes the market data object as input and returns a numpy array of booleans.</dt>
<dd>True indicates that we should try to roll the future at that row.</dd>
<dt>expiries: An optional dataframe with 2 columns, ‘series’ and ‘expiry’.  This should have one row per future series indicating that future’s expiry date.</dt>
<dd>If you don’t pass this in, the function will assume that the expiry column is present in the original dataframe.</dd>
<dt>return_full_df: If set, will return the datframe without removing extra dates so you can use your own logic for rolling, including the _next columns and </dt>
<dd>the roll flag</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd><dl class="first last docutils">
<dt>A pandas DataFrame with one row per date, which contains the columns in the original md DataFrame and the same columns suffixed with _next </dt>
<dd>representing the series we want to roll to.  There is also a column called roll_flag which is set to True whenever the date and roll condition functions are met.</dd>
</dl>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">md</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;date&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-11&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-16&#39;</span><span class="p">)),</span>
<span class="gp">... </span>                                           <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-11&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-16&#39;</span><span class="p">)))),</span>
<span class="gp">... </span>                   <span class="s1">&#39;c&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">10.2</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">10.35</span><span class="p">,</span> <span class="mf">10.45</span><span class="p">,</span> <span class="mf">10.55</span><span class="p">,</span> <span class="mf">10.65</span><span class="p">,</span> <span class="mf">10.75</span><span class="p">],</span>
<span class="gp">... </span>                   <span class="s1">&#39;v&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
<span class="gp">... </span>                   <span class="s1">&#39;series&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;MAR2018&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;JUN2018&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">})[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;series&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expiries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-03-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-06-15&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[D]&#39;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MAR2018&#39;</span><span class="p">,</span> <span class="s1">&#39;JUN2018&#39;</span><span class="p">],</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;expiry&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">date_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">md</span> <span class="p">:</span> <span class="n">md</span><span class="o">.</span><span class="n">expiry</span> <span class="o">-</span> <span class="n">md</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">condition_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">md</span> <span class="p">:</span> <span class="n">md</span><span class="o">.</span><span class="n">v_next</span> <span class="o">&gt;</span> <span class="n">md</span><span class="o">.</span><span class="n">v</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">roll_futures</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">date_func</span><span class="p">,</span> <span class="n">condition_func</span><span class="p">,</span> <span class="n">expiries</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">series</span> <span class="o">==</span> <span class="s1">&#39;MAR2018&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-14&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">series</span> <span class="o">==</span> <span class="s1">&#39;JUN2018&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-15&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.marketdata.test_marketdata">
<code class="descclassname">pyqstrat.marketdata.</code><code class="descname">test_marketdata</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/marketdata.html#test_marketdata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.marketdata.test_marketdata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-pyqstrat.optimize">
<span id="pyqstrat-optimize-module"></span><h2>pyqstrat.optimize module<a class="headerlink" href="#module-pyqstrat.optimize" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.optimize.Experiment">
<em class="property">class </em><code class="descclassname">pyqstrat.optimize.</code><code class="descname">Experiment</code><span class="sig-paren">(</span><em>suggestion</em>, <em>cost</em>, <em>other_costs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An Experiment stores a suggestion and its result
Attributes:</p>
<blockquote>
<div>suggestion: A dictionary of variable name -&gt; value
cost: A float representing output of the function we are testing with this suggestion as input.
other_costs: A dictionary of other results we want to store and look at later.</div></blockquote>
<dl class="method">
<dt id="pyqstrat.optimize.Experiment.valid">
<code class="descname">valid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Experiment.valid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Experiment.valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if all suggestions and costs are finite, i.e not NaN or +/- Infinity</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.optimize.Optimizer">
<em class="property">class </em><code class="descclassname">pyqstrat.optimize.</code><code class="descname">Optimizer</code><span class="sig-paren">(</span><em>name</em>, <em>generator</em>, <em>cost_func</em>, <em>max_processes=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Optimizer is used to optimize parameters for a strategy.</p>
<dl class="method">
<dt id="pyqstrat.optimize.Optimizer.df_experiments">
<code class="descname">df_experiments</code><span class="sig-paren">(</span><em>sort_column='cost'</em>, <em>ascending=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.df_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.df_experiments" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe containing experiment data, sorted by sort_column (default “cost”)</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.optimize.Optimizer.experiment_list">
<code class="descname">experiment_list</code><span class="sig-paren">(</span><em>sort_order='lowest_cost'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.experiment_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.experiment_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the list of experiments we have run
Args:</p>
<blockquote>
<div><dl class="docutils">
<dt>sort_order: Can be set to lowest_cost, highest_cost or sequence.  </dt>
<dd>If set to sequence, experiments are returned in the sequence in which they were run</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.optimize.Optimizer.plot_2d">
<code class="descname">plot_2d</code><span class="sig-paren">(</span><em>x</em>, <em>y='all'</em>, <em>plot_type='line'</em>, <em>figsize=(15</em>, <em>8)</em>, <em>marker='X'</em>, <em>marker_size=50</em>, <em>marker_color='r'</em>, <em>xlim=None</em>, <em>hspace=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.plot_2d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.plot_2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a 2D plot of the optimization output for plotting 1 parameter and costs.
Args:</p>
<blockquote>
<div><p>x: Name of the parameter to plot on the x axis, corresponding to the same name in the generator.
y: Can be one of:</p>
<blockquote>
<div>“cost” 
The name of another cost variable corresponding to the output from the cost function
“all”, which creates a subplot for cost plus all other costs</div></blockquote>
<p>plot_type: line or scatter (default line)
figsize: Figure size
marker: Adds a marker to each point in x, y to show the actual data used for interpolation.  You can set this to None to turn markers off.
hspace: Vertical space between subplots</p>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.optimize.Optimizer.plot_3d">
<code class="descname">plot_3d</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>z='all'</em>, <em>plot_type='surface'</em>, <em>figsize=(15</em>, <em>15)</em>, <em>interpolation='linear'</em>, <em>cmap='viridis'</em>, <em>marker='X'</em>, <em>marker_size=50</em>, <em>marker_color='r'</em>, <em>xlim=None</em>, <em>ylim=None</em>, <em>hspace=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.plot_3d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.plot_3d" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a 3D plot of the optimization output for plotting 2 parameters and costs.
Args:</p>
<blockquote>
<div><p>x: Name of the parameter to plot on the x axis, corresponding to the same name in the generator.
y: Name of the parameter to plot on the y axis, corresponding to the same name in the generator.
z: Can be one of:</p>
<blockquote>
<div>“cost” 
The name of another cost variable corresponding to the output from the cost function
“all”, which creates a subplot for cost plus all other costs</div></blockquote>
<p>plot_type: surface or contour (default surface)
figsize: Figure size
interpolation: Can be ‘linear’, ‘nearest’ or ‘cubic’ for plotting z points between the ones passed in.  See scipy.interpolate.griddata for details
cmap: Colormap to use (default viridis).  See matplotlib colormap for details
marker: Adds a marker to each point in x, y, z to show the actual data used for interpolation.  You can set this to None to turn markers off.
hspace: Vertical space between subplots</p>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.optimize.Optimizer.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>raise_on_error=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the optimizer.
Args:</p>
<blockquote>
<div><dl class="docutils">
<dt>raise_on_error: If set to True, even if we are running a multiprocess optimization, any Exceptions will bubble up and stop the Optimizer.</dt>
<dd>This can be useful for debugging to see stack traces for Exceptions.</dd>
</dl>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="pyqstrat.optimize.test_optimize">
<code class="descclassname">pyqstrat.optimize.</code><code class="descname">test_optimize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#test_optimize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.optimize.test_optimize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-pyqstrat.orders">
<span id="pyqstrat-orders-module"></span><h2>pyqstrat.orders module<a class="headerlink" href="#module-pyqstrat.orders" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.orders.LimitOrder">
<em class="property">class </em><code class="descclassname">pyqstrat.orders.</code><code class="descname">LimitOrder</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em>, <em>qty</em>, <em>limit_price</em>, <em>reason_code='none'</em>, <em>status='open'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#LimitOrder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.LimitOrder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="pyqstrat.orders.LimitOrder.params">
<code class="descname">params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#LimitOrder.params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.LimitOrder.params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.orders.MarketOrder">
<em class="property">class </em><code class="descclassname">pyqstrat.orders.</code><code class="descname">MarketOrder</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em>, <em>qty</em>, <em>reason_code='none'</em>, <em>status='open'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#MarketOrder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.MarketOrder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="pyqstrat.orders.MarketOrder.params">
<code class="descname">params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#MarketOrder.params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.MarketOrder.params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.orders.RollOrder">
<em class="property">class </em><code class="descclassname">pyqstrat.orders.</code><code class="descname">RollOrder</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em>, <em>close_qty</em>, <em>reopen_qty</em>, <em>reason_code='roll future'</em>, <em>status='open'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#RollOrder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.RollOrder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A roll order is used to roll a future from one series to the next.  It represents a sell of one future and the buying of another future.</p>
<dl class="method">
<dt id="pyqstrat.orders.RollOrder.params">
<code class="descname">params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#RollOrder.params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.RollOrder.params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.orders.StopLimitOrder">
<em class="property">class </em><code class="descclassname">pyqstrat.orders.</code><code class="descname">StopLimitOrder</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em>, <em>qty</em>, <em>trigger_price</em>, <em>limit_price=nan</em>, <em>reason_code='none'</em>, <em>status='open'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#StopLimitOrder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.StopLimitOrder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Used for stop loss or stop limit orders.  The order is triggered when price goes above or below trigger price, depending on whether this is a short
or long order.  Becomes either a market or limit order at that point, depending on whether you set the limit price or not.</p>
<dl class="method">
<dt id="pyqstrat.orders.StopLimitOrder.params">
<code class="descname">params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/orders.html#StopLimitOrder.params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.orders.StopLimitOrder.params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-pyqstrat.plot">
<span id="pyqstrat-plot-module"></span><h2>pyqstrat.plot module<a class="headerlink" href="#module-pyqstrat.plot" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.plot.BucketedValues">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">BucketedValues</code><span class="sig-paren">(</span><em>name</em>, <em>bucket_names</em>, <em>bucket_values</em>, <em>proportional_widths=True</em>, <em>show_means=True</em>, <em>show_all=True</em>, <em>show_outliers=False</em>, <em>notched=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#BucketedValues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.BucketedValues" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data in a subplot where x axis is a categorical we summarize properties of a numpy array.  For example, drawing a boxplot with percentiles.</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.DateFormatter">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">DateFormatter</code><span class="sig-paren">(</span><em>dates</em>, <em>fmt</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#DateFormatter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.DateFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">matplotlib.ticker.Formatter</span></code></p>
<p>Formats dates on plot axes.  See matplotlib Formatter</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.DateLine">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">DateLine</code><span class="sig-paren">(</span><em>date</em>, <em>name=None</em>, <em>line_type='dashed'</em>, <em>color=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#DateLine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.DateLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Draw a vertical line on a plot with a datetime x-axis</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.HorizontalLine">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">HorizontalLine</code><span class="sig-paren">(</span><em>y</em>, <em>name=None</em>, <em>line_type='dashed'</em>, <em>color=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#HorizontalLine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.HorizontalLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Draws a horizontal line on a subplot</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.OHLC">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">OHLC</code><span class="sig-paren">(</span><em>name</em>, <em>dates</em>, <em>o</em>, <em>h</em>, <em>l</em>, <em>c</em>, <em>v=None</em>, <em>colorup='darkgreen'</em>, <em>colordown='#F2583E'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#OHLC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.OHLC" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data in a subplot that contains open, high, low, close, volume bars.  volume is optional.</p>
<dl class="method">
<dt id="pyqstrat.plot.OHLC.df">
<code class="descname">df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#OHLC.df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.OHLC.df" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.plot.OHLC.reindex">
<code class="descname">reindex</code><span class="sig-paren">(</span><em>all_dates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#OHLC.reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.OHLC.reindex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.Plot">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">Plot</code><span class="sig-paren">(</span><em>subplot_list</em>, <em>title=None</em>, <em>figsize=(15</em>, <em>8)</em>, <em>date_range=None</em>, <em>date_format=None</em>, <em>sampling_frequency=None</em>, <em>show_grid=True</em>, <em>show_date_gaps=True</em>, <em>hspace=0.15</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#Plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.Plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Top level plot containing a list of subplots to draw</p>
<dl class="method">
<dt id="pyqstrat.plot.Plot.draw">
<code class="descname">draw</code><span class="sig-paren">(</span><em>check_data_size=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#Plot.draw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.Plot.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the subplots.
Args:</p>
<blockquote>
<div><dl class="docutils">
<dt>check_data_size: If set to True, will not plot if there are &gt; 100K points to avoid locking up your computer for a long time.</dt>
<dd>Default True</dd>
</dl>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.Subplot">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">Subplot</code><span class="sig-paren">(</span><em>data_list</em>, <em>title=None</em>, <em>xlabel=None</em>, <em>ylabel=None</em>, <em>zlabel=None</em>, <em>date_lines=None</em>, <em>horizontal_lines=None</em>, <em>vertical_lines=None</em>, <em>xlim=None</em>, <em>ylim=None</em>, <em>height_ratio=1.0</em>, <em>display_legend=True</em>, <em>legend_loc='best'</em>, <em>log_y=False</em>, <em>y_tick_format=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#Subplot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.Subplot" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A top level plot contains a list of subplots, each of which contain a list of data objects to draw</p>
<dl class="method">
<dt id="pyqstrat.plot.Subplot.get_all_dates">
<code class="descname">get_all_dates</code><span class="sig-paren">(</span><em>date_range</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#Subplot.get_all_dates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.Subplot.get_all_dates" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.TimeSeries">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">TimeSeries</code><span class="sig-paren">(</span><em>name</em>, <em>dates</em>, <em>values</em>, <em>plot_type='line'</em>, <em>line_type='solid'</em>, <em>line_width=None</em>, <em>color=None</em>, <em>marker=None</em>, <em>marker_size=50</em>, <em>marker_color='red'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#TimeSeries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.TimeSeries" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data in a subplot where x is an array of numpy datetimes and y is a numpy array of floats</p>
<dl class="method">
<dt id="pyqstrat.plot.TimeSeries.reindex">
<code class="descname">reindex</code><span class="sig-paren">(</span><em>dates</em>, <em>fill</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#TimeSeries.reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.TimeSeries.reindex" title="Permalink to this definition">¶</a></dt>
<dd><p>Reindex this series given a new array of dates, forward filling holes if fill is set to True</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.TradeSet">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">TradeSet</code><span class="sig-paren">(</span><em>name</em>, <em>trades</em>, <em>marker='P'</em>, <em>marker_color=None</em>, <em>marker_size=50</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#TradeSet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.TradeSet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data for subplot that contains a set of trades along with marker properties for these trades</p>
<dl class="method">
<dt id="pyqstrat.plot.TradeSet.reindex">
<code class="descname">reindex</code><span class="sig-paren">(</span><em>all_dates</em>, <em>fill</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#TradeSet.reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.TradeSet.reindex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.VerticalLine">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">VerticalLine</code><span class="sig-paren">(</span><em>x</em>, <em>name=None</em>, <em>line_type='dashed'</em>, <em>color=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#VerticalLine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.VerticalLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Draws a vertical line on a subplot where x axis is not a date-time axis</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.XYData">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">XYData</code><span class="sig-paren">(</span><em>name</em>, <em>x</em>, <em>y</em>, <em>plot_type='line'</em>, <em>line_type='solid'</em>, <em>line_width=None</em>, <em>color=None</em>, <em>marker=None</em>, <em>marker_size=50</em>, <em>marker_color='red'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#XYData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.XYData" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data in a subplot that has x and y values that are both arrays of floats
Args:</p>
<blockquote>
<div>x: pandas series or numpy array of floats
y: pandas series or numpy arry of floats</div></blockquote>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.plot.XYZData">
<em class="property">class </em><code class="descclassname">pyqstrat.plot.</code><code class="descname">XYZData</code><span class="sig-paren">(</span><em>name</em>, <em>x</em>, <em>y</em>, <em>z</em>, <em>plot_type='surface'</em>, <em>marker='X'</em>, <em>marker_size=50</em>, <em>marker_color='red'</em>, <em>interpolation='linear'</em>, <em>cmap='viridis'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#XYZData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.XYZData" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data in a subplot that has x, y and z values that are all floats</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_3d_plot">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_3d_plot</code><span class="sig-paren">(</span><em>ax</em>, <em>x</em>, <em>y</em>, <em>z</em>, <em>plot_type</em>, <em>marker='X'</em>, <em>marker_size=50</em>, <em>marker_color='red'</em>, <em>interpolation='linear'</em>, <em>cmap='viridis'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_3d_plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_3d_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a 3d plot.  See XYZData class for explanation of arguments
&gt;&gt;&gt; points = np.random.rand(1000, 2)
&gt;&gt;&gt; x = np.random.rand(10)
&gt;&gt;&gt; y = np.random.rand(10)
&gt;&gt;&gt; z = x ** 2 + y ** 2
&gt;&gt;&gt; if has_display():
…    fig, ax = plt.subplots()
…    draw_3d_plot(ax, x = x, y = y, z = z, plot_type = ‘contour’, interpolation = ‘linear’)</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_boxplot">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_boxplot</code><span class="sig-paren">(</span><em>ax</em>, <em>names</em>, <em>values</em>, <em>proportional_widths=True</em>, <em>notched=False</em>, <em>show_outliers=True</em>, <em>show_means=True</em>, <em>show_all=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_boxplot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_boxplot" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a boxplot.  See BucketedValues class for explanation of arguments</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_candlestick">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_candlestick</code><span class="sig-paren">(</span><em>ax</em>, <em>index</em>, <em>o</em>, <em>h</em>, <em>l</em>, <em>c</em>, <em>v</em>, <em>colorup='darkgreen'</em>, <em>colordown='#F2583E'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_candlestick"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_candlestick" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw candlesticks given parrallel numpy arrays of o, h, l, c, v values.  v is optional.  See OHLC class __init__ for argument descriptions.</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_date_line">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_date_line</code><span class="sig-paren">(</span><em>ax</em>, <em>plot_dates</em>, <em>date</em>, <em>linestyle</em>, <em>color</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_date_line"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_date_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw vertical line on a subplot with datetime x axis</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_horizontal_line">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_horizontal_line</code><span class="sig-paren">(</span><em>ax</em>, <em>y</em>, <em>linestyle</em>, <em>color</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_horizontal_line"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_horizontal_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw horizontal line on a subplot</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_poly">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_poly</code><span class="sig-paren">(</span><em>ax</em>, <em>left</em>, <em>bottom</em>, <em>top</em>, <em>right</em>, <em>facecolor</em>, <em>edgecolor</em>, <em>zorder</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_poly"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_poly" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a set of polygrams given parrallel numpy arrays of left, bottom, top, right points</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.draw_vertical_line">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">draw_vertical_line</code><span class="sig-paren">(</span><em>ax</em>, <em>x</em>, <em>linestyle</em>, <em>color</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#draw_vertical_line"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.draw_vertical_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw vertical line on a subplot</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.get_date_formatter">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">get_date_formatter</code><span class="sig-paren">(</span><em>plot_dates</em>, <em>date_format</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#get_date_formatter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.get_date_formatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an appropriate DateFormatter for x axis labels.  
If date_format is set to None, figures out an appropriate date format based on the range of dates passed in</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.test_plot">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">test_plot</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#test_plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.test_plot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="pyqstrat.plot.trade_sets_by_reason_code">
<code class="descclassname">pyqstrat.plot.</code><code class="descname">trade_sets_by_reason_code</code><span class="sig-paren">(</span><em>trades</em>, <em>marker_props={'backtest end': {'symbol': '*'</em>, <em>'color': 'green'</em>, <em>'size': 50}</em>, <em>'enter long': {'symbol': 'P'</em>, <em>'color': 'blue'</em>, <em>'size': 50}</em>, <em>'enter short': {'symbol': 'P'</em>, <em>'color': 'red'</em>, <em>'size': 50}</em>, <em>'exit long': {'symbol': 'X'</em>, <em>'color': 'blue'</em>, <em>'size': 50}</em>, <em>'exit short': {'symbol': 'X'</em>, <em>'color': 'red'</em>, <em>'size': 50}</em>, <em>'none': {'symbol': 'o'</em>, <em>'color': 'green'</em>, <em>'size': 50}</em>, <em>'roll future': {'symbol': '&gt;'</em>, <em>'color': 'green'</em>, <em>'size': 50}}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/plot.html#trade_sets_by_reason_code"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.plot.trade_sets_by_reason_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of TradeSet objects.  Each TradeSet contains trades with a different reason code.  The markers for each TradeSet
are set by looking up marker properties for each reason code using the marker_props argument:
Args:</p>
<blockquote>
<div><p>trades: List of Trade objects, each containing an order attribute which in turn contains a reason_code attribute
marker_props: Dictionary from reason code string -&gt; dictionary of marker properties.  See ReasonCode.MARKER_PROPERTIES for example.</p>
<blockquote>
<div>Default ReasonCode.MARKER_PROPERTIES</div></blockquote>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="module-pyqstrat.pq_utils">
<span id="pyqstrat-pq-utils-module"></span><h2>pyqstrat.pq_utils module<a class="headerlink" href="#module-pyqstrat.pq_utils" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.pq_utils.ReasonCode">
<em class="property">class </em><code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">ReasonCode</code><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#ReasonCode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class containing constants for predefined order reason codes. Prefer these predefined reason codes if they suit
the reason you are creating your order.  Otherwise, use your own string.</p>
<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.BACKTEST_END">
<code class="descname">BACKTEST_END</code><em class="property"> = 'backtest end'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.BACKTEST_END" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.ENTER_LONG">
<code class="descname">ENTER_LONG</code><em class="property"> = 'enter long'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.ENTER_LONG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.ENTER_SHORT">
<code class="descname">ENTER_SHORT</code><em class="property"> = 'enter short'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.ENTER_SHORT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.EXIT_LONG">
<code class="descname">EXIT_LONG</code><em class="property"> = 'exit long'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.EXIT_LONG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.EXIT_SHORT">
<code class="descname">EXIT_SHORT</code><em class="property"> = 'exit short'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.EXIT_SHORT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.MARKER_PROPERTIES">
<code class="descname">MARKER_PROPERTIES</code><em class="property"> = {'backtest end': {'symbol': '*', 'color': 'green', 'size': 50}, 'enter long': {'symbol': 'P', 'color': 'blue', 'size': 50}, 'enter short': {'symbol': 'P', 'color': 'red', 'size': 50}, 'exit long': {'symbol': 'X', 'color': 'blue', 'size': 50}, 'exit short': {'symbol': 'X', 'color': 'red', 'size': 50}, 'none': {'symbol': 'o', 'color': 'green', 'size': 50}, 'roll future': {'symbol': '&gt;', 'color': 'green', 'size': 50}}</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.MARKER_PROPERTIES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.NONE">
<code class="descname">NONE</code><em class="property"> = 'none'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.NONE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="pyqstrat.pq_utils.ReasonCode.ROLL_FUTURE">
<code class="descname">ROLL_FUTURE</code><em class="property"> = 'roll future'</em><a class="headerlink" href="#pyqstrat.pq_utils.ReasonCode.ROLL_FUTURE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.date_2_num">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">date_2_num</code><span class="sig-paren">(</span><em>d</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#date_2_num"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.date_2_num" title="Permalink to this definition">¶</a></dt>
<dd><p>Adopted from matplotlib.mdates.date2num so we don’t have to add a dependency on matplotlib here</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.has_display">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">has_display</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#has_display"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.has_display" title="Permalink to this definition">¶</a></dt>
<dd><p>If we are running in unit test mode or on a server, then don’t try to draw graphs, etc.</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.infer_frequency">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">infer_frequency</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#infer_frequency"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.infer_frequency" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns most common frequency of date differences as a fraction of days
Args:</p>
<blockquote>
<div>dates: A numpy array of monotonically increasing datetime64</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01 11:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:15:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:30:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:35:00&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[ns]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">infer_frequency</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
<span class="go">0.01041667</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.monotonically_increasing">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">monotonically_increasing</code><span class="sig-paren">(</span><em>array</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#monotonically_increasing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.monotonically_increasing" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the array is monotonically_increasing, False otherwise
&gt;&gt;&gt; monotonically_increasing(np.array([‘2018-01-02’, ‘2018-01-03’], dtype = ‘M8[D]’))
True
&gt;&gt;&gt; monotonically_increasing(np.array([‘2018-01-02’, ‘2018-01-02’], dtype = ‘M8[D]’))
False</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.nan_to_zero">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">nan_to_zero</code><span class="sig-paren">(</span><em>array</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#nan_to_zero"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.nan_to_zero" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts any nans in a numpy float array to 0</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.np_get_index">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">np_get_index</code><span class="sig-paren">(</span><em>array</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_get_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_get_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Get index of a value in a numpy array.  Returns -1 if the value does not exist.</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.resample_ohlc">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">resample_ohlc</code><span class="sig-paren">(</span><em>dates</em>, <em>o</em>, <em>h</em>, <em>l</em>, <em>c</em>, <em>v</em>, <em>sampling_frequency</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#resample_ohlc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.resample_ohlc" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-08 15:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09 15:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09 15:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-11 15:00:00&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[ns]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.9</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.8</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">8.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.95</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">9.35</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resample_ohlc</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="go">(array([&#39;2018-01-08T00:00:00.000000000&#39;, &#39;2018-01-09T00:00:00.000000000&#39;,</span>
<span class="go">        &#39;2018-01-10T00:00:00.000000000&#39;, &#39;2018-01-11T00:00:00.000000000&#39;], dtype=&#39;datetime64[ns]&#39;), </span>
<span class="go">        array([8.9, 9.1, nan, 8.6]), array([9. , 9.4, nan, 8.7]), array([8.8, 9. , nan, 8.4]), array([8.95, 9.35,  nan, 8.5 ]), None)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.resample_ts">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">resample_ts</code><span class="sig-paren">(</span><em>dates</em>, <em>values</em>, <em>sampling_frequency</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#resample_ts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.resample_ts" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample a pair of dates and values using sampling frequency, using the last value if it does not exist at bin edge.  See pandas.Series.resample
Args:</p>
<blockquote>
<div>dates: a numpy datetime64 array
values: a numpy array
sampling_frequency: See pandas frequency strings</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.series_to_array">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">series_to_array</code><span class="sig-paren">(</span><em>series</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#series_to_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.series_to_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a pandas series to a numpy array.  If the object is not a pandas Series return it back unchanged</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.set_defaults">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">set_defaults</code><span class="sig-paren">(</span><em>df_float_sf=4</em>, <em>df_display_max_rows=200</em>, <em>df_display_max_columns=99</em>, <em>np_seterr='raise'</em>, <em>plot_style='ggplot'</em>, <em>mpl_figsize=(8</em>, <em>6)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#set_defaults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.set_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Set some display defaults to make it easier to view dataframes and graphs.
Args:</p>
<blockquote>
<div>df_float_sf: Number of significant figures to show in dataframes (default 4). Set to None to use pandas defaults
df_display_max_rows: Number of rows to display for pandas dataframes when you print them (default 200).  Set to None to use pandas defaults
df_display_max_columns: Number of columns to display for pandas dataframes when you print them (default 99).  Set to None to use pandas defaults
np_seterr: Error mode for numpy warnings.  See numpy seterr function for details.  Set to None to use numpy defaults
plot_style: Style for matplotlib plots.  Set to None to use default plot style.
mpl_figsize: Default figure size to use when displaying matplotlib plots (default 8,6).  Set to None to use defaults</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.shift_np">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">shift_np</code><span class="sig-paren">(</span><em>array</em>, <em>n</em>, <em>fill_value=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#shift_np"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.shift_np" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to pandas.Series.shift but works on numpy arrays.
Args:</p>
<blockquote>
<div><p>array: The numpy array to shift
n: Number of places to shift, can be positive or negative
fill_value: After shifting, there will be empty slots left in the array.  If set, fill these with fill_value.</p>
<blockquote>
<div>If fill_value is set to None (default), we will fill these with False for boolean arrays, np.nan for floats</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.str2date">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">str2date</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#str2date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.str2date" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a string like “2008-01-15 15:00:00” to a numpy datetime64.  If s is not a string, return s back</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.strtup2date">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">strtup2date</code><span class="sig-paren">(</span><em>tup</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#strtup2date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.strtup2date" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a string tuple like (“2008-01-15”, “2009-01-16”) to a numpy datetime64 tuple.  
If the tuple does not contain strings, return it back unchanged</p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.pq_utils.zero_to_nan">
<code class="descclassname">pyqstrat.pq_utils.</code><code class="descname">zero_to_nan</code><span class="sig-paren">(</span><em>array</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#zero_to_nan"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.pq_utils.zero_to_nan" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts any zeros in a numpy array to nans</p>
</dd></dl>

</div>
<div class="section" id="module-pyqstrat.strategy">
<span id="pyqstrat-strategy-module"></span><h2>pyqstrat.strategy module<a class="headerlink" href="#module-pyqstrat.strategy" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyqstrat.strategy.Account">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">Account</code><span class="sig-paren">(</span><em>contracts</em>, <em>starting_equity=1000000.0</em>, <em>calc_frequency='D'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An Account calculates pnl for a set of contracts</p>
<dl class="method">
<dt id="pyqstrat.strategy.Account.add_contract">
<code class="descname">add_contract</code><span class="sig-paren">(</span><em>contract</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.add_contract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.add_contract" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.calc">
<code class="descname">calc</code><span class="sig-paren">(</span><em>i</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.calc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes P&amp;L and stores it internally for all contracts
Args:</p>
<blockquote>
<div>i: Index to compute P&amp;L at.  Account remembers the last index it computed P&amp;L up to and will compute P&amp;L between these two indices</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.df_pnl">
<code class="descname">df_pnl</code><span class="sig-paren">(</span><em>symbol=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.df_pnl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.df_pnl" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe with P&amp;L columns.  If symbol is set to None (default), sums up P&amp;L across symbols</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.df_trades">
<code class="descname">df_trades</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.df_trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.df_trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe with data from trades with the given symbol and with trade date between (and including) start date and end date
if they are specified.  If symbol is None, trades for all symbols are returned</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.equity">
<code class="descname">equity</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.equity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.equity" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns equity in this account in Account currency.  Will cause calculation if Account has not previously calculated up to this date</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.find_index_before">
<code class="descname">find_index_before</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.find_index_before"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.find_index_before" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the market data index before or at date</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.position">
<code class="descname">position</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.position"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.position" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns position for a symbol at a given date in number of contracts or shares.  Will cause calculation if Account has not previously calculated
up to this date</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.symbols">
<code class="descname">symbols</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.symbols"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.symbols" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.trades">
<code class="descname">trades</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of trades with the given symbol and with trade date between (and including) start date and end date if they are specified.
If symbol is None trades for all symbols are returned</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Account.transfer_cash">
<code class="descname">transfer_cash</code><span class="sig-paren">(</span><em>date</em>, <em>amount</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Account.transfer_cash"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Account.transfer_cash" title="Permalink to this definition">¶</a></dt>
<dd><p>Move cash from one portfolio to another</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.strategy.Contract">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">Contract</code><span class="sig-paren">(</span><em>symbol</em>, <em>marketdata</em>, <em>multiplier=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Contract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Contract" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A Contract can be a real or virtual instrument. For example, for futures you may wish to create a single continous contract instead of
a contract for each future series</p>
</dd></dl>

<dl class="class">
<dt id="pyqstrat.strategy.ContractPNL">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">ContractPNL</code><span class="sig-paren">(</span><em>contract</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#ContractPNL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.ContractPNL" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Computes pnl for a single contract over time given trades and market data</p>
<dl class="method">
<dt id="pyqstrat.strategy.ContractPNL.add_trades">
<code class="descname">add_trades</code><span class="sig-paren">(</span><em>trades</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#ContractPNL.add_trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.ContractPNL.add_trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Args:
trades: A list of Trade objects</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.ContractPNL.calc">
<code class="descname">calc</code><span class="sig-paren">(</span><em>prev_i</em>, <em>i</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#ContractPNL.calc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.ContractPNL.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute pnl and store it internally
Args:</p>
<blockquote>
<div>prev_i: Start index to compute pnl from
i: End index to compute pnl to</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.ContractPNL.df">
<code class="descname">df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#ContractPNL.df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.ContractPNL.df" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a pandas dataframe with pnl data, indexed by date</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.ContractPNL.trades">
<code class="descname">trades</code><span class="sig-paren">(</span><em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#ContractPNL.trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.ContractPNL.trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of trades
Args:</p>
<blockquote>
<div>start_date: A string or numpy datetime64.  Trades with trade dates &gt;= start_date will be returned.  Default None
end_date: A string or numpy datetime64.  Trades with trade dates &lt;= end_date will be returned.  Default None</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.strategy.Portfolio">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">Portfolio</code><span class="sig-paren">(</span><em>name='main'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A portfolio contains one or more strategies that run concurrently so you can test running strategies that are uncorrelated together.</p>
<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.add_strategy">
<code class="descname">add_strategy</code><span class="sig-paren">(</span><em>name</em>, <em>strategy</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.add_strategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.add_strategy" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Args:</dt>
<dd>name: Name of the strategy
strategy: Strategy object</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.df_returns">
<code class="descname">df_returns</code><span class="sig-paren">(</span><em>sampling_frequency='D'</em>, <em>strategy_names=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.df_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.df_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Return dataframe containing equity and returns with a date index.  Equity and returns are combined from all strategies passed in.
Args:</p>
<blockquote>
<div>sampling_frequency: Date frequency for rows.  Default ‘D’ for daily so we will have one row per day
strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.evaluate_returns">
<code class="descname">evaluate_returns</code><span class="sig-paren">(</span><em>sampling_frequency='D'</em>, <em>strategy_names=None</em>, <em>plot=True</em>, <em>float_precision=4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.evaluate_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.evaluate_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of common return metrics.
Args:</p>
<blockquote>
<div>sampling_frequency: Date frequency.  Default ‘D’ for daily so we downsample to daily returns before computing metrics
strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.
plot: If set to True, display plots of equity, drawdowns and returns.  Default False
float_precision: Number of significant figures to show in returns.  Default 4</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.plot">
<code class="descname">plot</code><span class="sig-paren">(</span><em>sampling_frequency='D'</em>, <em>strategy_names=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Display plots of equity, drawdowns and returns
Args:</p>
<blockquote>
<div>sampling_frequency: Date frequency.  Default ‘D’ for daily so we downsample to daily returns before computing metrics
strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>strategy_names=None</em>, <em>start_date=None</em>, <em>end_date=None</em>, <em>run_first=False</em>, <em>run_last=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run indicators, signals and rules.  
Args:</p>
<blockquote>
<div><p>strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.
start_date: Run rules starting from this date.</p>
<blockquote>
<div>Sometimes we have a few strategies in a portfolio that need different lead times before they are ready to trade
so you can set this so they are all ready by this date.  Default None</div></blockquote>
<p>end_date: Don’t run rules after this date.  Default None
run_first: Force running rules on the first bar even if signals do not require this.  Default False
run_last: Force running rules on penultimate bar even if signals do not require this.</p>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.run_indicators">
<code class="descname">run_indicators</code><span class="sig-paren">(</span><em>strategy_names=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.run_indicators"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.run_indicators" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute indicators for the strategies specified
Args:</p>
<blockquote>
<div>strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.run_rules">
<code class="descname">run_rules</code><span class="sig-paren">(</span><em>strategy_names=None</em>, <em>start_date=None</em>, <em>end_date=None</em>, <em>run_first=False</em>, <em>run_last=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.run_rules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.run_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Run rules for the strategies specified.  Must be called after run_indicators and run_signals.  
See run function for argument descriptions</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Portfolio.run_signals">
<code class="descname">run_signals</code><span class="sig-paren">(</span><em>strategy_names=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Portfolio.run_signals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Portfolio.run_signals" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute signals for the strategies specified.  Must be called after run_indicators
Args:</p>
<blockquote>
<div>strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.strategy.Strategy">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">Strategy</code><span class="sig-paren">(</span><em>contracts</em>, <em>starting_equity=1000000.0</em>, <em>calc_frequency='D'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="pyqstrat.strategy.Strategy.add_indicator">
<code class="descname">add_indicator</code><span class="sig-paren">(</span><em>name</em>, <em>indicator_function</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_indicator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_indicator" title="Permalink to this definition">¶</a></dt>
<dd><p>Args:
name: Name of the indicator
indicator_function:  A function taking a MarketData object and returning a numpy array</p>
<blockquote>
<div>containing indicator values.  The return array must have the same length as the MarketData object</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.add_market_sim">
<code class="descname">add_market_sim</code><span class="sig-paren">(</span><em>market_sim_function</em>, <em>symbols=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_market_sim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_market_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a market simulator.  A market simulator takes a list of Orders as input and returns a list of Trade objects
Args:</p>
<blockquote>
<div>market_sim_function: A function that takes a list of Orders and MarketData as input and returns a list of Trade objects
symbols: A list of the symbols that this market_sim_function applies to. If None (default) it will apply to all symbols</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.add_rule">
<code class="descname">add_rule</code><span class="sig-paren">(</span><em>name</em>, <em>rule_function</em>, <em>signal_name</em>, <em>sig_true_values</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_rule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a trading rule
Args:</p>
<blockquote>
<div>name: Name of the trading rule
rule_function: A trading rule function that returns a list of Orders
signal_name: The strategy will call the trading rule function when the signal with this name matches sig_true_values
sig_true_values: A numpy array of values.  If the signal value at a bar is equal to one of these, the Strategy will call the trading rule function</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.add_signal">
<code class="descname">add_signal</code><span class="sig-paren">(</span><em>name</em>, <em>signal_function</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_signal" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Args:</dt>
<dd><p class="first">name: Name of the signal
signal_function:  A function taking a MarketData object and a dictionary of indicator value arrays as input and returning a numpy array</p>
<blockquote class="last">
<div>containing signal values.  The return array must have the same length as the MarketData object</div></blockquote>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.df_data">
<code class="descname">df_data</code><span class="sig-paren">(</span><em>symbols=None</em>, <em>add_pnl=True</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Add indicators and signals to end of market data and return as a pandas dataframe
Args:</p>
<blockquote>
<div>symbols: list of symbols to include.  All if set to None (default)
add_pnl: If True (default), include P&amp;L columns in dataframe
start_date: string or numpy datetime64. Default None
end_date: string or numpy datetime64: Default None</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.df_orders">
<code class="descname">df_orders</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_orders"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_orders" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe with data from orders with the given symbol and with order date between (and including) start date and end date
if they are specified.  If symbol is None, orders for all symbols are returned</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.df_pnl">
<code class="descname">df_pnl</code><span class="sig-paren">(</span><em>symbol=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_pnl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_pnl" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe with P&amp;L columns.  If symbol is set to None (default), sums up P&amp;L across symbols</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.df_returns">
<code class="descname">df_returns</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>sampling_frequency='D'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dataframe of returns and equity indexed by date.
Args:</p>
<blockquote>
<div>symbol: The symbol to get returns for.  If set to None (default), this returns the sum of PNL for all symbols
sampling_frequency: Downsampling frequency.  Default is None.  See pandas frequency strings for possible values</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.df_trades">
<code class="descname">df_trades</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dataframe with data from trades with the given symbol and with trade date between (and including) start date and end date
if they are specified.  If symbol is None, trades for all symbols are returned</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.evaluate_returns">
<code class="descname">evaluate_returns</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>plot=True</em>, <em>float_precision=4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.evaluate_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.evaluate_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of common return metrics.
Args:</p>
<blockquote>
<div>sampling_frequency: Date frequency.  Default ‘D’ for daily so we downsample to daily returns before computing metrics
strategy_names: A list of strategy names.  By default this is set to None and we use all strategies.
plot: If set to True, display plots of equity, drawdowns and returns.  Default False
float_precision: Number of significant figures to show in returns.  Default 4</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.marketdata">
<code class="descname">marketdata</code><span class="sig-paren">(</span><em>symbol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.marketdata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.marketdata" title="Permalink to this definition">¶</a></dt>
<dd><p>Return MarketData object for this symbol</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.orders">
<code class="descname">orders</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.orders"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.orders" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of orders with the given symbol and with order date between (and including) start date and end date if they are specified.
If symbol is None orders for all symbols are returned</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.plot">
<code class="descname">plot</code><span class="sig-paren">(</span><em>symbols=None</em>, <em>md_columns='c'</em>, <em>pnl_columns='equity'</em>, <em>title=None</em>, <em>figsize=(20</em>, <em>15)</em>, <em>date_range=None</em>, <em>date_format=None</em>, <em>sampling_frequency=None</em>, <em>trade_marker_properties=None</em>, <em>hspace=0.15</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot indicators, signals, trades, position, pnl
Args:</p>
<blockquote>
<div><p>symbols: List of symbols or None (default) for all symbols
md_columns: List of columns of market data to plot.  Default is ‘c’ for close price.  You can set this to ‘ohlcv’ if you want to plot</p>
<blockquote>
<div>a candlestick of OHLCV data</div></blockquote>
<p>pnl_columns: List of P&amp;L columns to plot.  Default is ‘equity’
title: Title of plot (None)
figsize: Figure size.  Default is (20, 15)
date_range: Tuple of strings or datetime64, e.g. (“2018-01-01”, “2018-04-18 15:00”) to restrict the graph.  Default None
date_format: Date format for tick labels on x axis.  If set to None (default), will be selected based on date range. See matplotlib date format strings
sampling_frequency: Downsampling frequency.  Default is None.  The graph may get too busy if you have too many bars of data, in which case you may want to</p>
<blockquote>
<div>downsample before plotting.  See pandas frequency strings for possible values</div></blockquote>
<dl class="docutils">
<dt>trade_marker_properties: A dictionary of order reason code -&gt; marker shape, marker size, marker color for plotting trades with different reason codes.</dt>
<dd>Default is None in which case the dictionary from the ReasonCode class is used</dd>
</dl>
<p>hspace: Height (vertical) space between subplots.  Default is 0.15</p>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.plot_returns">
<code class="descname">plot_returns</code><span class="sig-paren">(</span><em>symbol=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.plot_returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.plot_returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Display plots of equity, drawdowns and returns for the given symbol or for all symbols if symbol is None (default)</p>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.run_indicators">
<code class="descname">run_indicators</code><span class="sig-paren">(</span><em>indicator_names=None</em>, <em>symbols=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_indicators"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_indicators" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate values of the indicators specified and store them.
Args:</p>
<blockquote>
<div>indicator_names: List of indicator names.  If None (default) run all indicators
symbols: List of symbols to run these indicators for.  If None (default) use all symbols</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.run_rules">
<code class="descname">run_rules</code><span class="sig-paren">(</span><em>rule_names=None</em>, <em>symbols=None</em>, <em>start_date=None</em>, <em>end_date=None</em>, <em>run_first=False</em>, <em>run_last=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_rules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Run trading rules.
Args:</p>
<blockquote>
<div>rule_names: List of rule names.  If None (default) run all rules
symbols: List of symbols to run these signals for.  If None (default) use all symbols
start_date: Run rules starting from this date. Default None 
end_date: Don’t run rules after this date.  Default None
run_first: Force running rules on the first bar even if signals do not require this.  Default False
run_last: Force running rules on penultimate bar even if signals do not require this.</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.run_signals">
<code class="descname">run_signals</code><span class="sig-paren">(</span><em>signal_names=None</em>, <em>symbols=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_signals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_signals" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate values of the signals specified and store them.
Args:</p>
<blockquote>
<div>signal_names: List of signal names.  If None (default) run all signals
symbols: List of symbols to run these signals for.  If None (default) use all symbols</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="pyqstrat.strategy.Strategy.trades">
<code class="descname">trades</code><span class="sig-paren">(</span><em>symbol=None</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.trades"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.trades" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of trades with the given symbol and with trade date between (and including) start date and end date if they are specified.
If symbol is None trades for all symbols are returned</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pyqstrat.strategy.Trade">
<em class="property">class </em><code class="descclassname">pyqstrat.strategy.</code><code class="descname">Trade</code><span class="sig-paren">(</span><em>symbol</em>, <em>date</em>, <em>qty</em>, <em>price</em>, <em>fee=0.0</em>, <em>commission=0.0</em>, <em>order=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Trade"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.Trade" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="function">
<dt id="pyqstrat.strategy.test_strategy">
<code class="descclassname">pyqstrat.strategy.</code><code class="descname">test_strategy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#test_strategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyqstrat.strategy.test_strategy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-pyqstrat.test_pyqstrat">
<span id="pyqstrat-test-pyqstrat-module"></span><h2>pyqstrat.test_pyqstrat module<a class="headerlink" href="#module-pyqstrat.test_pyqstrat" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-pyqstrat.version">
<span id="pyqstrat-version-module"></span><h2>pyqstrat.version module<a class="headerlink" href="#module-pyqstrat.version" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-pyqstrat">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pyqstrat" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pyqstrat</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyqstrat package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyqstrat.examples.html">pyqstrat.examples package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.evaluator">pyqstrat.evaluator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.marketdata">pyqstrat.marketdata module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.optimize">pyqstrat.optimize module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.orders">pyqstrat.orders module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.plot">pyqstrat.plot module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.pq_utils">pyqstrat.pq_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.strategy">pyqstrat.strategy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.test_pyqstrat">pyqstrat.test_pyqstrat module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat.version">pyqstrat.version module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-pyqstrat">Module contents</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to pyqstrat’s documentation!</a></li>
      <li>Next: <a href="pyqstrat.examples.html" title="next chapter">pyqstrat.examples package</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/pyqstrat.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>